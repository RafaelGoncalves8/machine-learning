\documentclass[a4paper, 12pt]{article}

\usepackage[portuges]{babel}
\usepackage[utf8]{inputenc}
\usepackage[margin=1.2in]{geometry}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{datetime}
\usepackage{enumerate}
\renewcommand{\baselinestretch}{1.5}

\emergencystretch 1pt%
\setlength{\parindent}{0pt}

\title{EFC3 - MLP e SVM}
\author{Rafael Gonçalves - RA: 186062}

\begin{document}


\maketitle

\section*{Parte I - Revisitando o algoritmo de retropropagação de erro}


\section*{Parte II - Atividade computacional}

\subsection*{a) Solução fechada com MMQ}

$
\mathbf{X} =\begin{bmatrix}
    \mathbf{x_1} \\
    \mathbf{x_2} \\
    \vdots \\
    \mathbf{x_N}
\end{bmatrix}
$
\hspace{2em}
$
\boldsymbol{\Phi} = \boldsymbol{\Phi}(\mathbf{X}) = \begin{bmatrix}
    1 & \mathbf{x_1} \\
    1 & \mathbf{x_2} \\
    &\vdots \\
    1 & \mathbf{x_N}
\end{bmatrix}
$
\hspace{2em}
$
\mathbf{y} =\begin{bmatrix}
    y_1 \\
    y_2 \\
    \vdots \\
    y_N
\end{bmatrix}
$

\vspace{1em}

Modelo:
\begin{equation}
    \mathbf{\hat{y}} = \mathbf{\hat{y}}(\mathbf{X}) = \boldsymbol{\Phi}\mathbf{w}
\end{equation}

Solução ótima com o método de mínimos múltiplos quadrados (MMQ):
\begin{equation}
    \mathbf{w} = (\boldsymbol{\Phi}^T\boldsymbol{\Phi})^{-1}\boldsymbol{\Phi}^T\mathbf{y}
\end{equation}

Raiz quadrada do erro quadrático médio (RMSE) para o modelo treinado com o conjunto de treino:

$ RMSE _{train} = 15.3702$
\hspace{2em}
$ RMSE _{test} = 14.2495$

Resultado no conjunto de teste:

\begin{figure}[h!]
    \centering
    \includegraphics[width=9cm]{images/raw.png}
    \caption{Saída prevista pelo modelo (azul) em comparação com valores reais dos últimos 5 anos (60 meses).}
\end{figure}

\subsection*{b) Seleção de atributos usando wrapper (backward elimination), validação cruzada (k-fold) e regularização L2}

Solução por MMQ com regularização ridge (L2):
\begin{equation}
    \mathbf{w} = (\boldsymbol{\Phi}^T\boldsymbol{\Phi} + \lambda\mathbf{I'})^{-1}\boldsymbol{\Phi}^T\mathbf{y}
\end{equation}

\begin{figure}[h!]
    \centering
    \includegraphics[width=8cm]{images/backward.png}
    \caption{Menor RMSE para cada passo do wrapper (atributo retirado).}
\end{figure}

Modelo escolhido pelo wrapper utilizando k-fold com 5 pastas:

N de atributos removidos: $9 \quad \lambda: 10000 \quad RMSE_{CV}: 15.4201 \quad RMSE_{test}: 14.4200$

Atributos escolhidos: 0 (bias) , 1, 2, 3, 4, 5, 6, 8, 9, 11, 18, 20

\begin{figure}[h!]
    \centering
    \includegraphics[width=9cm]{images/wrapper.png}
    \caption{Saída prevista pelo modelo (azul) em comparação com valores reais dos últimos 5 anos (60 meses) com seleção de atributos usando wrapper.}
\end{figure}

\begin{table}[]
    \centering
    \caption{RMSE mínimo e respectivo lambda para cada número de atributos retirados.}
\begin{tabular}{lll}
N atributos retirados & min RMSE & lambda \\
0                     & 15.4585 & 30000 \\
1                     & 15.4441 & 30000 \\
2                     & 15.4355 & 30000 \\
3                     & 15.4311 & 30000 \\
4                     & 15.4280 & 30000 \\
5                     & 15.4255 & 30000 \\
6                     & 15.4238 & 10000 \\
7                     & 15.4226 & 10000 \\
8                     & 15.4212 & 10000 \\
9                     & 15.4201 & 10000 \\
10                    & 15.4202 & 10000 \\
11                    & 15.4216 & 10000 \\
12                    & 15.4268 & 10000 \\
13                    & 15.4392 & 6000  \\
14                    & 15.4893 & 6000  \\
15                    & 15.5565 & 1000  \\
16                    & 15.7354 & 0     \\
17                    & 16.0103 & 0     \\
18                    & 16.0801 & 0     \\
19                    & 16.8718 & 0
\end{tabular}
\end{table}


\subsection*{c) Seleção de atributos usando filtro (correlação de Pearson)}

\begin{figure}[h!]
    \centering
    \includegraphics[width=7cm]{images/corr.png}
    \caption{Matriz de correlação, onde uma cor mais avermelhada significa uma correlação maior (dados foram alinhados na matriz de forma que a primeira linha e coluna correspondem ao rótulo e as próximas linhas e colunas correspondem aos atributos - mês anterior até 20 meses atrás).}
\end{figure}

Modelo escolhido pelo filtro (11 atributos com maior correlação):

Atributos selecionados: 0 (bias) , 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11

$\lambda: 10000 \quad\quad RMSE_{CV}: 15.7380 \quad\quad RMSE_{test}: 13.8367$

\begin{figure}[h!]
    \centering
  \includegraphics[width=9cm]{images/filter.png}
    \caption{Saída prevista pelo modelo (azul) em comparação com valores reais dos últimos 5 anos (60 meses) com seleção de atributos usando filtro.}
\end{figure}

\begin{figure}[h!]
    \centering
  \includegraphics[width=9cm]{images/comparison.png}
    \caption{Saída prevista por cada modelo: azul - modelo inicial com 20 atributos, RMSE = 14.2495; amarelo - modelo criado usando wrapper, RMSE = 14.1138; verde - modelo criado usando filtro, RMSE = 13.8367;  em comparação com valores reais (vermelho) dos últimos 5 anos (60 meses).}
\end{figure}


\hspace{2em} Ambas as estratégias de seleção de atributos em conjunto com a regularização L2 mostraram melhoria em relação ao uso de todos os 20 atributos sem regularização. Podemos observar que embora o erro de validação tenha sido menor na abordagem com seleção de atributos usando wrapper, o erro no conjunto de testes foi menor na abordagem de filtro. Isso pode ser consequência de o modelo utilizado ser linear e portanto se beneficiar diretamente por atributos que tenha uma correlação com os rótulos.

\hspace{2em} Também vale notar que o modelo gerado com seleção de atributos pelo wrapper leva em consideração o erro da validação para escolher quais atributos usar, enquanto que o modelo gerado pelo filtro não leva em conta o erro da validação para seleção de atributos, apenas a correlação entre cada atributo e o rótulo e, sendo assim, faz sentido que o modelo do wrapper apresente um erro menor de validação em comparação ao modelo gerado usando filtro. Em todo o caso o resultado nos mostra que o modelo que obteve um melhor desempenho em dados novos foi o modelo gerado com o filtro e é o modelo que deve ser usado em uma aplicação - provavelmente terá melhor desempenho.

\end{document}
